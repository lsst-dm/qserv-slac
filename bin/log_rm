#!/bin/bash

# Reconfigure logger services of select workers

set -e

# Load parameters of the setup into the corresponding environment
# variables

. $(dirname "$0")/config/env

if [ -n "${CZAR_DB}" ]; then
    sudo -u qserv rm -vf ${LOG_DIR}/${CZAR_DB_CONTAINER_NAME}.*.log&
fi
if [ -n "${CZAR_CMSD}" ]; then
    sudo -u qserv rm -vf ${LOG_DIR}/${CZAR_CMSD_CONTAINER_NAME}.log&
fi
if [ -n "${CZAR_XROOTD}" ]; then
    sudo -u qserv rm -vf ${LOG_DIR}/${CZAR_XROOTD_CONTAINER_NAME}.log&
fi
if [ -n "${CZAR_PROXY}" ]; then
    sudo -u qserv rm -vf ${LOG_DIR}/${CZAR_PROXY_CONTAINER_NAME}.mysql-proxy.log&
    sudo -u qserv rm -vf ${LOG_DIR}/${CZAR_PROXY_CONTAINER_NAME}.log&
fi
if [ -n "${WORKER_DB}" ]; then
  for WORKER in $WORKERS; do
    ssh -n $WORKER 'sudo -u qserv rm -vf '${LOG_DIR}'/'${WORKER_DB_CONTAINER_NAME}'.*.log'&
  done
fi
if [ -n "${WORKER_CMSD}" ]; then
  for WORKER in $WORKERS; do
    ssh -n $WORKER 'sudo -u qserv rm -vf '${LOG_DIR}'/'${WORKER_CMSD_CONTAINER_NAME}'.log'&
  done
fi
if [ -n "${WORKER_XROOTD}" ]; then
  for WORKER in $WORKERS; do
    ssh -n $WORKER 'sudo -u qserv rm -vf '${LOG_DIR}'/'${WORKER_XROOTD_CONTAINER_NAME}'.log'&
  done
fi
if [ -n "${REPL_DB}" ]; then
    sudo -u qserv rm -vf ${LOG_DIR}/${REPL_DB_CONTAINER_NAME}.*.log&
fi
if [ -n "${REPL_REG}" ]; then
    sudo -u qserv rm -vf ${LOG_DIR}/${REPL_REG_CONTAINER_NAME}.log&
fi
if [ -n "${REPL_CONTR}" ]; then
    sudo -u qserv rm -vf ${LOG_DIR}/${REPL_CONTR_CONTAINER_NAME}.log&
fi
if [ -n "${REPL_WORKER}" ]; then
  for WORKER in $WORKERS; do
    ssh -n $WORKER 'sudo -u qserv rm -vf '${LOG_DIR}'/'${REPL_WORKER_CONTAINER_NAME}'.log'&
  done
fi
wait
